angular.module("anime",["ngRoute","anime.resource"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/anime",{templateUrl:"anime/list.html",controller:"AnimeListCtrl",authRequired:!0})}]).controller("AnimeListCtrl",["$scope","Animes","$location","$filter","valuesService",function($scope,Animes,$location,$filter,valuesService){function removeAnime(anime){$scope.animes.splice($scope.animes.indexOf(anime),1)}$scope.animes=Animes.items,$scope.remove=function(anime){anime.remove().then(function(){removeAnime(anime)})},$scope.update=function(anime){valuesService.update(anime).then(function(updated){updated.editable=!1})},$scope.cancel=function(anime){anime.isnew&&($scope.newanime={}),anime.editable=!1},$scope.add=function(){$scope.newanime={isnew:!0}},$scope.create=function(anime){Animes.post(anime).then(function(addedAnime){$scope.newanime={},$scope.animes.push(addedAnime)},function(){console.log("Error")})},$scope.finished=function(anime){valuesService.finished(anime)},$scope.increaseEp=function(anime){valuesService.increaseEp(anime)},$scope.decreaseEp=function(anime){valuesService.decreaseEp(anime)}}]),angular.module("anime.resource",["restangular"]).factory("Animes",["Restangular",function(restangular){var Animes=restangular.all("anime");return Animes.items=Animes.getList().$object,Animes}]),angular.module("14all",["ui.bootstrap","manga","movie","auth","serie","anime","14all.templates"]).config(["RestangularProvider",function(RestangularProvider){RestangularProvider.setRestangularFields({id:"_id"}),RestangularProvider.setBaseUrl("/api")}]).controller("AppCtrl",["$scope","authService",function($scope,authService){$scope.isLoggedIn=authService.isLoggedIn,$scope.logout=authService.logout}]),angular.module("auth",["ngRoute"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/login",{templateUrl:"auth/login.html",controller:["$scope","authService","$routeParams",function($scope,authService,$routeParams){$routeParams.token&&authService.login($routeParams.token),$scope.heading="Login",$scope.message="You need to login to view this page!"}]}).when("/notauthorized",{templateUrl:"auth/message.html",controller:["$scope","authService",function($scope){$scope.heading="Not Authorized",$scope.message="You are not authorized to view this page!"}]}).when("/logout",{templateUrl:"auth/message.html",controller:["$scope","authService",function($scope,authService){$scope.heading="Logout",$scope.message="Your logout was a success!",authService.logout()}]}).otherwise({templateUrl:"auth/message.html",controller:["$scope",function($scope){$scope.heading="Welcome!",$scope.message="Welcome to 14all! :)"}]})}]).run(["$rootScope","authService","$location",function($rootScope,authService,$location){authService.authenticate().then(function(){$rootScope.$on("$routeChangeStart",function(event,next){next.$$route&&next.$$route.authRequired&&(authService.isLoggedIn()||$location.path("/login"))})})}]).factory("authService",["Restangular","$location",function(Restangular,$location){function getAuthInfo(){return Restangular.oneUrl("auth/info").get().then(function(response){authInfo=response},function(){authInfo={}})}function isLoggedIn(){return authInfo&&authInfo.user&&authInfo.user.username}function authenticate(){return Restangular.setDefaultHeaders({Authorization:"Bearer "+localStorage.getItem("access_token")}),getAuthInfo()}function setToken(access_token){localStorage.setItem("access_token",access_token),authenticate()}function login(access_token){setToken(access_token),$location.url("/")}function logout(){Restangular.oneUrl("auth/logout").post().then(function(){localStorage.removeItem("access_token"),authInfo={},Restangular.setDefaultHeaders({Authorization:""}),$location.url("/")})}function isAuthorized(){}var authInfo,service={isLoggedIn:isLoggedIn,login:login,authenticate:authenticate,getAuthInfo:getAuthInfo,logout:logout,isAuthorized:isAuthorized,authInfo:authInfo};return service}]),angular.module("manga",["ngRoute","manga.resource"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/manga",{templateUrl:"manga/list.html",controller:"MangaListCtrl",authRequired:!0})}]).controller("MangaListCtrl",["$scope","Mangas","$location","$filter","valuesService",function($scope,Mangas,$location,$filter,valuesService){function removeManga(manga){$scope.mangas.splice($scope.mangas.indexOf(manga),1)}$scope.mangas=Mangas.items,$scope.remove=function(manga){manga.remove().then(function(){removeManga(manga)})},$scope.update=function(manga){valuesService.update(manga).then(function(updated){updated.editable=!1})},$scope.cancel=function(manga){manga.isnew&&($scope.newmanga={}),manga.editable=!1},$scope.add=function(){$scope.newmanga={isnew:!0}},$scope.create=function(manga){Mangas.post(manga).then(function(addedManga){$scope.newmanga={},$scope.mangas.push(addedManga)},function(){console.log("Error")})},$scope.finished=function(manga){valuesService.finished(manga)},$scope.increase=function(manga){valuesService.increaseCh(manga)},$scope.decrease=function(manga){valuesService.decreaseCh(manga)},$scope.getNextChapterUrl=function(manga){if(manga.finished)return"";var url=manga.url,chapter=manga.chapter+1;return url?url.replace("$$chapter$$",chapter):""}}]),angular.module("manga.resource",["restangular"]).factory("Mangas",["Restangular",function(restangular){var Mangas=restangular.all("manga");return Mangas.items=Mangas.getList().$object,Mangas}]),angular.module("movie",["ngRoute","movie.resource"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/movie",{templateUrl:"movie/list.html",controller:"MovieListCtrl",authRequired:!0})}]).controller("MovieListCtrl",["$scope","Movies","$location","$filter","valuesService",function($scope,Movies,$location,$filter,valuesService){function removeMovie(movie){$scope.movies.splice($scope.movies.indexOf(movie),1)}$scope.movies=Movies.items,$scope.remove=function(movie){movie.remove().then(function(){removeMovie(movie)})},$scope.update=function(movie){valuesService.update(movie).then(function(updated){updated.editable=!1})},$scope.cancel=function(movie){movie.isnew&&($scope.newmovie={}),movie.editable=!1},$scope.add=function(){$scope.newmovie={isnew:!0}},$scope.create=function(movie){Movies.post(movie).then(function(addedMovie){$scope.newmovie={},$scope.movies.push(addedMovie)},function(){console.log("Error")})},$scope.finished=function(movie){valuesService.finished(movie)}}]),angular.module("movie.resource",["restangular"]).factory("Movies",["Restangular",function(restangular){var Movies=restangular.all("movie");return Movies.items=Movies.getList().$object,Movies}]),angular.module("serie",["ngRoute","serie.resource"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/serie",{templateUrl:"serie/list.html",controller:"SerieListCtrl",authRequired:!0})}]).controller("SerieListCtrl",["$scope","Series","$location","$filter","valuesService",function($scope,Series,$location,$filter,valuesService){function removeSerie(serie){$scope.series.splice($scope.series.indexOf(serie),1)}$scope.series=Series.items,$scope.remove=function(serie){serie.remove().then(function(){removeSerie(serie)})},$scope.update=function(){valuesService.then(function(updated){updated.editable=!1})},$scope.cancel=function(serie){serie.isnew&&($scope.newserie={}),serie.editable=!1},$scope.add=function(){$scope.newserie={isnew:!0}},$scope.create=function(serie){Series.post(serie).then(function(addedSerie){$scope.newserie={},$scope.series.push(addedSerie)},function(){console.log("Error")})},$scope.finished=function(serie){valuesService.finished(serie)},$scope.increaseSe=function(serie){valuesService.increaseSe(serie)},$scope.decreaseSe=function(serie){valuesService.decreaseSe(serie)},$scope.increaseEp=function(serie){valuesService.increaseEp(serie)},$scope.decreaseEp=function(serie){valuesService.decreaseEp(serie)}}]),angular.module("serie.resource",["restangular"]).factory("Series",["Restangular",function(restangular){var Series=restangular.all("serie");return Series.items=Series.getList().$object,Series}]),angular.module("14all").filter("isFinished",function(){return function(input,enabled){if(!enabled)return input;var ret=[];return angular.forEach(input,function(item){(angular.isUndefined(item.finished)||!item.finished)&&ret.push(item)}),ret}}),angular.module("14all").factory("jsonStorage",[function(){function getItem(key){return localStorage.getItem(key)}function setItem(key,value){localStorage.setItem(key,value)}function getJson(key){return JSON.parse(getItem(key))}function setJson(key,value){setItem(key,JSON.stringify(value))}var service={getItem:getItem,setItem:setItem,getJson:getJson,setJson:setJson};return service}]),angular.module("14all").factory("valuesService",[function(){function finished(item){return item.finished=!item.finished,update(item)}function update(item){return item.put().then(function(updated){return item.updatedAt=updated.updatedAt,item})}function increase(value){return value+=1}function decrease(value){return 0>=value?value=0:value-=1,value}function increaseEp(item){var episode=item.episode;return item.episode=increase(item.episode),episode!==item.episode?update(item):void 0}function decreaseEp(item){var episode=item.episode;return item.episode=decrease(item.episode),episode!==item.episode?update(item):void 0}function increaseCh(item){var chapter=item.chapter;return item.chapter=increase(item.chapter),chapter!==item.chapter?update(item):void 0}function decreaseCh(item){var chapter=item.chapter;return item.chapter=decrease(item.chapter),chapter!==item.chapter?update(item):void 0}function increaseSe(item){var season=item.season;return item.season=increase(item.season),season!==item.season?update(item):void 0}function decreaseSe(item){var season=item.season;return item.season=decrease(item.season),season!==item.season?update(item):void 0}var service={increase:increase,decrease:decrease,increaseEp:increaseEp,decreaseEp:decreaseEp,increaseCh:increaseCh,decreaseCh:decreaseCh,increaseSe:increaseSe,decreaseSe:decreaseSe,update:update,finished:finished};return service}]);